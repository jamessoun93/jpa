# JPA Basics

- 엔티티 매니저 팩토리는 하나만 생성해서 애플리케이션 전체에서 공유
- 엔티티 매니저는 쓰레드간에 공유하지 않음 (사용하고 버려야 함)
- JPA의 모든 데이터 변경은 트랜잭션 안에서 실행

## JPQL
- JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공
- SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원
- JPQL은 엔티티 객체를 대상으로 쿼리
- SQL은 데이터베이스 테이블을 대상으로 쿼리
- 테이블이 아닌 객체를 대상으로 검색하는 객체 지향 쿼리
- SQL을 추상화해서 특정 데이터베이스 SQL에 의존X
- JPQL을 한마디로 정의하면 객체 지향 SQL

## 영속성 컨텍스트

### 영속 상태
- 엔티티 매니저의 persist 메서드를 통해 객체를 등록하면 영속 상태가 됨.
- 영속 상태가 된다고 해서 DB 쿼리가 바로 날라가는 것이 아님.
- 트랜잭션 커밋 시점에 DB 쿼리가 날라감.
- 

## 영속성 컨텍스트의 이점

- 1차 캐시
  - key가 @Id 즉 PK로 맵핑한 값이고 값은 Entity 객체 자체가 된다.
  - em.find: 먼저 1차 캐시를 조회하고 없다면 DB에서 가져와서 1차 캐시에 저장 후 반환
  - 하나의 DB 트랜잭션 동안만 살아있기 때문에 큰 성능 개선 효과는 기대하기 힘듬
  - 동시요청이 여럿 있을 때 성능상 도움을 주는 형태가 아니라는 뜻.
  - 
  
- 변경 감지 (Dirty Checking)
  - 엔티티 값 변경할 때 자바 컬렉션에서 하는 것 처럼 그냥 setter 써서 변경하면 된다. (persist 별도 호출 불필요)
  - transaction이 커밋되는 시점에 쓰기 지연 저장소에 있던 쿼리들과 같이 flush 된다.